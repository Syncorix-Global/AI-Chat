<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>TypingObserver demo</title>
    <style>
      :root {
        --c-focus: #3b82f6;   /* blue */
        --c-typing: #10b981;  /* green */
        --c-pause:  #f59e0b;  /* amber */
        --c-stop:   #ef4444;  /* red */
        --c-blur:   #6b7280;  /* gray */
        --c-ring:   rgba(59, 130, 246, 0.25);
      }
      body { font-family: system-ui, sans-serif; padding: 24px; line-height: 1.4; }
      .row { display: grid; grid-template-columns: 1fr auto; gap: 12px; align-items: start; }
      textarea { width: 100%; height: 120px; padding: 10px; font: inherit; border-radius: 10px; border: 2px solid #e5e7eb; outline: none; transition: border-color .18s ease; }
      pre { background: #f6f8fa; padding: 12px; border-radius: 8px; max-height: 280px; overflow: auto; }
      .status {
        display: inline-flex; align-items: center; gap: 8px;
        padding: 8px 12px; border-radius: 999px; font-weight: 600;
        border: 1px solid #e5e7eb; background: #fff; color: #111827;
        box-shadow: 0 1px 2px rgba(0,0,0,.05);
        user-select: none;
      }
      .dot { width: 10px; height: 10px; border-radius: 50%; background: #9ca3af; }
      .hint { font-size: 12px; color: #6b7280; margin-top: 4px; }
      /* Border highlight + subtle glow */
      .ring {
        box-shadow: 0 0 0 6px var(--c-ring);
      }
      /* Quick pulse when an event fires */
      .pulse { animation: pulse .45s ease-out; }
      @keyframes pulse {
        0%   { transform: scale(1); }
        40%  { transform: scale(1.01); }
        100% { transform: scale(1); }
      }
    </style>
  </head>
  <body>
    <h1>TypingObserver demo</h1>

    <div class="row">
      <div>
        <textarea id="message" placeholder="Type here..."></textarea>
        <div class="hint">Visual cues: border color + glow + status pill update when events fire.</div>
      </div>
      <div class="status" id="status">
        <span class="dot" id="dot"></span>
        <span id="label">Idle</span>
      </div>
    </div>

    <h3>Event log</h3>
    <pre id="log"></pre>

    <script type="module">
      import { observeTyping, TypingObserverEvent } from "../../../dist/typing-observer.js";

      const el = document.getElementById("message");
      const logEl = document.getElementById("log");
      const statusEl = document.getElementById("status");
      const dotEl = document.getElementById("dot");
      const labelEl = document.getElementById("label");

      const write = (msg) => (logEl.textContent += msg + "\n");
      const setTheme = (colorVar, ringVar = "--c-ring") => {
        el.style.borderColor = getComputedStyle(document.documentElement).getPropertyValue(colorVar).trim();
        document.documentElement.style.setProperty(ringVar, hexToRgba(getComputedStyle(document.documentElement).getPropertyValue(colorVar).trim(), 0.25));
        el.classList.remove("pulse");
        // restart animation
        void el.offsetWidth;
        el.classList.add("pulse", "ring");
      };
      const setStatus = (text, colorVar) => {
        labelEl.textContent = text;
        dotEl.style.background = getComputedStyle(document.documentElement).getPropertyValue(colorVar).trim();
      };

      // helper: convert #rrggbb to rgba
      function hexToRgba(hex, a = 0.25) {
        const h = hex.replace("#","");
        const b = parseInt(h.length === 3 ? h[2]+h[2] : h.slice(4,6), 16);
        const g = parseInt(h.length === 3 ? h[1]+h[1] : h.slice(2,4), 16);
        const r = parseInt(h.length === 3 ? h[0]+h[0] : h.slice(0,2), 16);
        return `rgba(${r}, ${g}, ${b}, ${a})`;
      }

      const observer = observeTyping("#message", { pauseDelay: 700, stopDelay: 1400 });

      observer.on(TypingObserverEvent.Focus, () => {
        write("[Focus]");
        setTheme("--c-focus");
        setStatus("Focused", "--c-focus");
      });

      observer.on(TypingObserverEvent.TypingStart, () => {
        write("[Start]");
        setTheme("--c-typing");
        setStatus("Typing…", "--c-typing");
      });

      observer.on(TypingObserverEvent.Typing, (e) => {
        write(`[Typing] value="${e.value}"`);
        setTheme("--c-typing");
        setStatus("Typing…", "--c-typing");
      });

      observer.on(TypingObserverEvent.TypingPause, () => {
        write("[Pause]");
        setTheme("--c-pause");
        setStatus("Paused", "--c-pause");
      });

      observer.on(TypingObserverEvent.TypingStop, () => {
        write("[Stop]");
        setTheme("--c-stop");
        setStatus("Stopped", "--c-stop");
        // remove glow after stop for calm UI
        setTimeout(() => el.classList.remove("ring"), 350);
      });

      observer.on(TypingObserverEvent.Blur, () => {
        write("[Blur]");
        setTheme("--c-blur");
        setStatus("Blurred", "--c-blur");
        // fade ring out on blur
        setTimeout(() => el.classList.remove("ring"), 350);
      });
    </script>
  </body>
</html>
